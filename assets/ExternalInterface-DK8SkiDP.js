import{d as x,r as P,o as k,c as T,a as C,b as l,e,w as a,f as r,i as o,k as b,j as I,_ as D}from"./index-D9XT-uxJ.js";const R={class:"interface-regulations"},S={class:"section"},F={class:"dark-content-box"},A={class:"section"},L={class:"dark-content-box"},M={class:"section"},N={class:"section"},O={class:"dark-content-box"},J={class:"tab-content"},E={class:"section"},B={class:"dark-content-box"},V={class:"section"},G={class:"dark-content-box"},U={class:"section"},W={class:"dark-content-box"},j={class:"section"},K={class:"dark-content-box"},X=x({__name:"ExternalInterface",setup(q){const u=P(null),g=[{platform:"Steam",authMethod:"OAuth2.0",rateLimit:"1000/min",dataFormat:"Protobuf"},{platform:"微信",authMethod:"JWT",rateLimit:"500/min",dataFormat:"JSON"},{platform:"Discord",authMethod:"API Key",rateLimit:"200/min",dataFormat:"MessagePack"},{platform:"Facebook",authMethod:"OAuth2.0",rateLimit:"600/min",dataFormat:"JSON"},{platform:"Apple",authMethod:"JWT+OAuth",rateLimit:"800/min",dataFormat:"JSON"}],_=[{feature:"好友导入",steam:"完全支持",wechat:"部分支持",discord:"完全支持"},{feature:"成就系统",steam:"完全支持",wechat:"不支持",discord:"部分支持"},{feature:"内购验证",steam:"完全支持",wechat:"完全支持",discord:"不支持"},{feature:"聊天集成",steam:"部分支持",wechat:"完全支持",discord:"完全支持"},{feature:"直播集成",steam:"完全支持",wechat:"部分支持",discord:"完全支持"}],h=[{id:"PT-001",scenario:"正常支付流程",steps:"1.创建订单 2.发起支付 3.模拟支付成功 4.接收回调",expected:'订单状态变为"已支付"，发放对应虚拟物品'},{id:"PT-002",scenario:"支付超时",steps:"1.创建订单 2.发起支付 3.支付未完成 4.等待超时",expected:'订单状态变为"已超时"，系统自动查询最新状态'},{id:"PT-003",scenario:"支付失败",steps:"1.创建订单 2.发起支付 3.模拟支付失败",expected:'订单状态变为"支付失败"，用户可重新尝试'},{id:"PT-004",scenario:"退款流程",steps:"1.查询已支付订单 2.发起退款请求 3.模拟退款成功",expected:'订单状态变为"已退款"，回收已发放的虚拟物品'}],v=[{code:"4xx",category:"客户端错误",suggestion:"终止当前操作，提示用户检查输入"},{code:"5xx",category:"服务端错误",suggestion:"自动重试3次，间隔递增"},{code:"6xx",category:"业务异常",suggestion:"记录日志告警，根据具体错误码处理"}],y=[{errorType:"网络超时",retryInterval:"指数退避",maxRetries:"5",fallbackPlan:"事务回滚"},{errorType:"服务不可用",retryInterval:"固定1s",maxRetries:"3",fallbackPlan:"切换备用"},{errorType:"数据冲突",retryInterval:"立即重试",maxRetries:"1",fallbackPlan:"人工干预"},{errorType:"授权失败",retryInterval:"无重试",maxRetries:"0",fallbackPlan:"强制重新登录"},{errorType:"资源限制",retryInterval:"3s固定",maxRetries:"2",fallbackPlan:"降级服务"}],p=i=>i==="完全支持"?"success":i==="部分支持"?"warning":i==="不支持"?"danger":"info";return k(()=>{u.value&&T(u.value,`
      stateDiagram-v2
        [*] --> Created: 创建订单
        Created --> Processing: 发起支付
        Processing --> Success: 支付成功
        Processing --> Failed: 支付失败
        Processing --> Timeout: 超时
        
        Success --> Completed: 发货完成
        Success --> Refunding: 申请退款
        Refunding --> Refunded: 退款成功
        Refunding --> RefundFailed: 退款失败
        
        Failed --> Created: 重新支付
        Failed --> Canceled: 取消订单
        Timeout --> Processing: 重试支付
        Timeout --> Canceled: 超过重试次数
        
        Completed --> [*]
        Refunded --> [*]
        RefundFailed --> [*]
        Canceled --> [*]
    `)}),(i,t)=>{const n=r("el-table-column"),d=r("el-table"),c=r("el-tag"),m=r("el-tab-pane"),w=r("el-tabs"),f=r("el-card");return I(),C("div",R,[t[18]||(t[18]=l("h2",null,"外部接口规范",-1)),l("div",S,[t[0]||(t[0]=l("h3",null,"2.1 第三方平台对接",-1)),t[1]||(t[1]=l("h4",null,"2.1.1 社交平台接口",-1)),l("div",F,[e(d,{data:g,border:"",style:{width:"100%"}},{default:a(()=>[e(n,{prop:"platform",label:"平台类型",width:"150"}),e(n,{prop:"authMethod",label:"认证方式",width:"180"}),e(n,{prop:"rateLimit",label:"速率限制",width:"150"}),e(n,{prop:"dataFormat",label:"数据格式"})]),_:1})])]),l("div",A,[t[2]||(t[2]=l("h3",null,"平台特性兼容矩阵",-1)),l("div",L,[e(d,{data:_,border:"",style:{width:"100%"}},{default:a(()=>[e(n,{prop:"feature",label:"功能特性",width:"180"}),e(n,{prop:"steam",label:"Steam"},{default:a(s=>[e(c,{type:p(s.row.steam)},{default:a(()=>[o(b(s.row.steam),1)]),_:2},1032,["type"])]),_:1}),e(n,{prop:"wechat",label:"微信"},{default:a(s=>[e(c,{type:p(s.row.wechat)},{default:a(()=>[o(b(s.row.wechat),1)]),_:2},1032,["type"])]),_:1}),e(n,{prop:"discord",label:"Discord"},{default:a(s=>[e(c,{type:p(s.row.discord)},{default:a(()=>[o(b(s.row.discord),1)]),_:2},1032,["type"])]),_:1})]),_:1})])]),l("div",M,[t[3]||(t[3]=l("h3",null,"2.2 支付系统接口",-1)),t[4]||(t[4]=l("h4",null,"2.2.1 交易状态机",-1)),l("div",{ref_key:"transactionDiagram",ref:u,class:"diagram-container"},null,512)]),l("div",N,[t[10]||(t[10]=l("h3",null,"支付系统对接规范",-1)),l("div",O,[e(f,null,{default:a(()=>[e(w,{type:"border-card"},{default:a(()=>[e(m,{label:"安全要求"},{default:a(()=>t[5]||(t[5]=[l("div",{class:"tab-content"},[l("h4",null,"接口安全措施"),l("ul",null,[l("li",null,[l("strong",null,"签名验证"),l("p",null,"所有支付相关请求必须包含数字签名，服务器端进行签名验证，防止请求被篡改")]),l("li",null,[l("strong",null,"非对称加密"),l("p",null,"敏感交易信息使用RSA-2048加密，确保传输过程中数据安全")]),l("li",null,[l("strong",null,"幂等性处理"),l("p",null,"每个交易请求都必须有唯一标识，防止重复处理同一笔交易")]),l("li",null,[l("strong",null,"IP白名单"),l("p",null,"支付回调接口仅接受支付服务提供商的IP请求")]),l("li",null,[l("strong",null,"交易记录多重备份"),l("p",null,"交易数据同时写入多个存储系统，确保数据不会丢失")])])],-1)])),_:1,__:[5]}),e(m,{label:"异常处理"},{default:a(()=>t[6]||(t[6]=[l("div",{class:"tab-content"},[l("h4",null,"支付异常处理流程"),l("ol",null,[l("li",null,[l("strong",null,"支付超时"),l("p",null,"设置60秒超时时间，超时后自动查询交易状态")]),l("li",null,[l("strong",null,"回调失败"),l("p",null,"支付服务商回调失败时，实现指数退避重试机制，最多重试5次")]),l("li",null,[l("strong",null,"订单状态不一致"),l("p",null,"每5分钟执行一次对账流程，识别并修复订单状态不一致问题")]),l("li",null,[l("strong",null,"退款处理"),l("p",null,"支持全额和部分退款，退款操作需要双重授权")]),l("li",null,[l("strong",null,"人工干预"),l("p",null,"异常交易触发人工干预流程，系统生成处理工单")])])],-1)])),_:1,__:[6]}),e(m,{label:"沙箱环境"},{default:a(()=>[l("div",J,[t[7]||(t[7]=l("h4",null,"沙箱测试策略",-1)),t[8]||(t[8]=l("ul",null,[l("li",null,[l("strong",null,"测试环境地址:"),o(" https://sandbox-api.fps-game.com/payment")]),l("li",null,[l("strong",null,"测试账号:"),o(" 自动生成10个不同特征的测试账号")]),l("li",null,[l("strong",null,"模拟场景:"),o(" 正常支付、部分成功、延迟到账、退款场景")]),l("li",null,[l("strong",null,"测试覆盖率:"),o(" 100% API覆盖，95% 异常情况覆盖")]),l("li",null,[l("strong",null,"自动化测试:"),o(" 每次代码提交自动执行回归测试")])],-1)),t[9]||(t[9]=l("h4",{class:"mt-20"},"沙箱测试用例示例",-1)),e(d,{data:h,border:"",style:{width:"100%"}},{default:a(()=>[e(n,{prop:"id",label:"用例ID",width:"100"}),e(n,{prop:"scenario",label:"测试场景",width:"150"}),e(n,{prop:"steps",label:"步骤"}),e(n,{prop:"expected",label:"预期结果",width:"200"})]),_:1})])]),_:1})]),_:1})]),_:1})])]),l("div",E,[t[11]||(t[11]=l("h3",null,"3. 错误处理规范",-1)),t[12]||(t[12]=l("h4",null,"3.1 状态码体系",-1)),l("div",B,[e(d,{data:v,border:"",style:{width:"100%"}},{default:a(()=>[e(n,{prop:"code",label:"错误码",width:"100"}),e(n,{prop:"category",label:"分类",width:"150"}),e(n,{prop:"suggestion",label:"处理建议"})]),_:1})])]),l("div",V,[t[13]||(t[13]=l("h3",null,"3.2 重试策略矩阵",-1)),l("div",G,[e(d,{data:y,border:"",style:{width:"100%"}},{default:a(()=>[e(n,{prop:"errorType",label:"错误类型",width:"180"}),e(n,{prop:"retryInterval",label:"重试间隔",width:"150"}),e(n,{prop:"maxRetries",label:"最大次数",width:"120"}),e(n,{prop:"fallbackPlan",label:"补偿方案"})]),_:1})])]),l("div",U,[t[15]||(t[15]=l("h3",null,"合规性检查清单",-1)),l("div",W,[e(f,null,{default:a(()=>t[14]||(t[14]=[l("div",{class:"compliance-checklist"},[l("ul",null,[l("li",null,[l("strong",null,"GDPR合规"),l("div",{class:"compliance-details"},[l("p",null,"所有与EU用户相关的接口必须:"),l("ul",null,[l("li",null,"提供数据导出能力"),l("li",null,'支持"被遗忘权"数据删除'),l("li",null,"实现明确的用户同意流程"),l("li",null,"数据传输加密保护")])])]),l("li",null,[l("strong",null,"PCI DSS要求"),l("div",{class:"compliance-details"},[l("p",null,"支付接口必须满足PCI DSS 3.2.1标准:"),l("ul",null,[l("li",null,"不存储完整的信用卡号"),l("li",null,"传输过程中使用TLS 1.2+"),l("li",null,"访问支付系统的人员需要双因素认证"),l("li",null,"每季度进行渗透测试")])])]),l("li",null,[l("strong",null,"本地化法规"),l("div",{class:"compliance-details"},[l("p",null,"根据不同地区调整API行为:"),l("ul",null,[l("li",null,"中国区: 实名认证接口、防沉迷系统对接"),l("li",null,"韩国区: 游戏时长限制、年龄分级"),l("li",null,"中东地区: 内容过滤接口"),l("li",null,"巴西: 本地支付方式对接")])])])])],-1)])),_:1,__:[14]})])]),l("div",j,[t[17]||(t[17]=l("h3",null,"特别说明",-1)),l("div",K,[e(f,null,{default:a(()=>t[16]||(t[16]=[l("div",{class:"special-notes"},[l("ul",null,[l("li",null,[l("strong",null,"社交接口需支持GFX内容过滤"),o(" - 确保用户生成内容符合各国家/地区的内容政策")]),l("li",null,[l("strong",null,"支付回调需签名验证+非对称加密"),o(" - 确保交易的真实性和安全性")]),l("li",null,[l("strong",null,"接口版本管理策略"),o(" - 外部接口版本统一在URL中显式声明，如 /v1/api/payment")]),l("li",null,[l("strong",null,"流量突增应对方案"),o(" - 活动期间可能出现流量高峰，需实现请求排队和削峰机制")]),l("li",null,[l("strong",null,"敏感数据脱敏规则"),o(" - 日志和错误报告中的敏感信息（如支付信息、用户标识）必须脱敏处理")]),l("li",null,[l("strong",null,"接口监控埋点规范"),o(" - 所有外部接口调用需记录性能和错误率，设置适当的告警阈值")])])],-1)])),_:1,__:[16]})])])])}}}),H=D(X,[["__scopeId","data-v-577b1b6f"]]);export{H as default};
